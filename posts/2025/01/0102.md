# TODO List

Reference  
* [[Android Webview ì‚¬ìš© ì˜ˆì œ](https://junhyunny.github.io/android/android-webview/)]  
* [[React ì„œë¹„ìŠ¤ í™”ë©´ê³¼ Android Webview í†µì‹ ](https://junhyunny.github.io/react/android/react-android-webview-communication/)]  
  
  
---  
title: "Android Webview ì‚¬ìš© ì˜ˆì œ"  
search: false  
category:  
  - android
last_modified_at: 2022-03-05T23:55:00
---    

<br/>

ğŸ‘‰ ì´ì–´ì„œ ì½ê¸°ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.
- [React ì„œë¹„ìŠ¤ í™”ë©´ê³¼ Android Webview í†µì‹ ][react-android-webview-communication-link]

## 0. ë“¤ì–´ê°€ë©´ì„œ

ë„¤ì´í‹°ë¸Œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì›¹ ë·°(Webview)ë¥¼ ì´ìš©í•´ ìƒˆë¡œ ê°œë°œí•˜ëŠ” ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•  ì˜ˆì •ì´ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. 
ì›¹ë·°ë¡œ ë‹¨ìˆœíˆ í™”ë©´ì„ ë³´ì—¬ì£¼ë©´ ë¬¸ì œê°€ ì—†ê² ì§€ë§Œ, ë„¤ì´í‹°ë¸Œì˜ ì¤‘ìš” ëª¨ë“ˆì„ ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ì—ì„œ í˜¸ì¶œí•  ê°€ëŠ¥ì„±ì´ ì»¸ìŠµë‹ˆë‹¤. 
ë„¤ì´í‹°ë¸Œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ì €í¬ íŒ€ì˜ ì¼ì´ ì•„ë‹ˆì—ˆì§€ë§Œ, ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ê°€ ì–´ë–»ê²Œ ë„¤ì´í‹°ë¸Œ ì•±ê³¼ í†µì‹ í•˜ëŠ”ì§€ ì´í•´í•˜ê³ ì ê°„ë‹¨í•œ ì˜ˆì‹œ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì•˜ìŠµë‹ˆë‹¤. 
ì¼ë‹¨ ì´ë²ˆì—” ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ì™€ í†µì‹ í•  ê°„ë‹¨í•œ ì›¹ ë·° ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

## 1. íŒ¨í‚¤ì§€ êµ¬ì¡°
- build, libs, test, androidTest íŒ¨í‚¤ì§€ ì œì™¸
- values, mipmap ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” íŒ¨í‚¤ì§€ ì œì™¸

```
 % tree -I 'build|libs|test|androidTest|values*|mipmap*' .
.
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ build.gradle
â”‚   â”œâ”€â”€ proguard-rules.pro
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main
â”‚           â”œâ”€â”€ AndroidManifest.xml
â”‚           â”œâ”€â”€ java
â”‚           â”‚   â””â”€â”€ com
â”‚           â”‚       â””â”€â”€ example
â”‚           â”‚           â””â”€â”€ myapplication
â”‚           â”‚               â”œâ”€â”€ FirstFragment.java
â”‚           â”‚               â””â”€â”€ MainActivity.java
â”‚           â””â”€â”€ res
â”‚               â”œâ”€â”€ drawable
â”‚               â”‚   â””â”€â”€ ic_launcher_background.xml
â”‚               â”œâ”€â”€ drawable-v24
â”‚               â”‚   â””â”€â”€ ic_launcher_foreground.xml
â”‚               â”œâ”€â”€ layout
â”‚               â”‚   â”œâ”€â”€ activity_main.xml
â”‚               â”‚   â”œâ”€â”€ content_main.xml
â”‚               â”‚   â””â”€â”€ fragment_first.xml
â”‚               â”œâ”€â”€ menu
â”‚               â”‚   â””â”€â”€ menu_main.xml
â”‚               â””â”€â”€ navigation
â”‚                   â””â”€â”€ nav_graph.xml
â”œâ”€â”€ build.gradle
â”œâ”€â”€ gradle
â”‚   â””â”€â”€ wrapper
â”‚       â”œâ”€â”€ gradle-wrapper.jar
â”‚       â””â”€â”€ gradle-wrapper.properties
â”œâ”€â”€ gradle.properties
â”œâ”€â”€ gradlew
â”œâ”€â”€ gradlew.bat
â”œâ”€â”€ local.properties
â””â”€â”€ settings.gradle
```

## 2. ì•ˆë“œë¡œì´ë“œ ê¶Œí•œ ë¶€ì—¬

##### AndroidManifest.xml

- ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¸í„°ë„· ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê¶Œí•œì„ ìš”ì²­í•©ë‹ˆë‹¤.
    - `uses-permissio` íƒœê·¸ `android:name="android.permission.INTERNET"`
- HTTP í˜¸ì¶œ ì‹œ ì•ˆë“œë¡œì´ë“œ OS 9 Pie ë²„ì „ë¶€í„° ì¶”ê°€ì ì¸ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
    - `application` íƒœê·¸ `android:usesCleartextTraffic="true"` ì„¤ì •

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.example.myapplication">

    <uses-permission android:name="android.permission.INTERNET"/>

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.MyApplication"

        android:usesCleartextTraffic="true"
        >
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:label="@string/app_name"
            android:theme="@style/Theme.MyApplication.NoActionBar">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>

</manifest>
```

###### Android for Developers - Network security configuration
- `usesCleartextTraffic` ì„¤ì • ê´€ë ¨ëœ ë‚´ìš©ì…ë‹ˆë‹¤.

> [Opt out of cleartext traffic][cleartext-traffic-link]<br/>
> Applications intending to connect to destinations using only secure connections 
> can opt-out of supporting cleartext 
> (using the unencrypted HTTP protocol instead of HTTPS) to those destinations. 

## 3. ë ˆì•„ì´ì›ƒ ì„¤ì •

`Android Studio Bumblebee` ë²„ì „ì—ì„œ ì œê³µí•˜ëŠ” ë² ì´ì§(basic) í”„ë¡œì íŠ¸ë¥¼ ì¼ë¶€ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤. 
- `fragment_second.xml` íŒŒì¼ì€ ì œê±°í•˜ì˜€ìŠµë‹ˆë‹¤.
- `nav_graph.xml` íŒŒì¼ì—ì„œ `fragment_second.xml` í™”ë©´ ì „í™˜ê³¼ ê´€ë ¨ëœ ì½”ë“œëŠ” ì‚­ì œí•˜ì˜€ìŠµë‹ˆë‹¤.
- `activity_main.xml`, `content_main.xml` ê´€ë ¨ëœ ë‚´ìš©ì—” ë³€ê²½ì´ ì—†ìŠµë‹ˆë‹¤. 

##### fragment_first.xml
- `EditText` íƒœê·¸ - URLì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ ë°•ìŠ¤ ë·°(view)ì…ë‹ˆë‹¤.
- `WebView` íƒœê·¸ - ì›¹ë·°ì…ë‹ˆë‹¤.
- `ProgressBar` íƒœê·¸ - ë¡œë”© ì¤‘ì„ì„ í‘œì—¬ì£¼ê¸° ìœ„í•œ ë·°ì…ë‹ˆë‹¤.

```xml
<?xml version="1.0" encoding="utf-8"?>

<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <EditText
        android:id="@+id/urlEt"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”."
        android:inputType="textUri" />

    <FrameLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:layout_weight="1">

        <WebView
            android:id="@+id/wView"
            android:layout_width="match_parent"
            android:layout_height="match_parent" />

        <ProgressBar
            android:id="@+id/pBar"
            style="?android:attr/progressBarStyle"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="center" />
    </FrameLayout>

</LinearLayout>
```

##### nav_graph.xml
- í™”ë©´ ì´ë™ ê´€ê³„ë¥¼ í‘œí˜„í•˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.
- ë„¤ë¹„ê²Œì´ì…˜ì„ ì´ìš©í•  ë•Œ ê°€ì¥ ë¨¼ì € ì‹œì‘í•˜ëŠ” í”„ë˜ê·¸ë¨¼íŠ¸(fragment)ëŠ” `FirstFragment`ì…ë‹ˆë‹¤.
    - `app:startDestination="@id/FirstFragment"`
- `fragment_first` ë ˆì´ì•„ì›ƒê³¼ `FirstFragment` í´ë˜ìŠ¤ë¥¼ ë§¤ì¹­í•©ë‹ˆë‹¤.
    - `fragment` íƒœê·¸ `android:name="com.example.myapplication.FirstFragment"`
    - `fragment` íƒœê·¸ `tools:layout="@layout/fragment_first"`
- ë² ì´ì§ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” `SecondFragment` ê´€ë ¨ ë‚´ìš©ì„ ì‚­ì œí•˜ì˜€ìŠµë‹ˆë‹¤. 

```xml
<?xml version="1.0" encoding="utf-8"?>

<navigation
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/nav_graph"
    app:startDestination="@id/FirstFragment">

    <fragment
        android:id="@+id/FirstFragment"
        android:name="com.example.myapplication.FirstFragment"
        android:label="@string/first_fragment_label"
        tools:layout="@layout/fragment_first">
    </fragment>

</navigation>
```

## 4. ì›¹ ë·° ì„¤ì • ë° ì½œë°± ì´ë²¤íŠ¸ ì¶”ê°€

`fragment_first.xml` ë ˆì´ì•„ì›ƒê³¼ ë§¤ì¹­ë˜ëŠ” `FirstFragment` í´ë˜ìŠ¤ì—ì„œ í•„ìš”í•œ ì„¤ì •ê³¼ ì½œë°±(callback) í•¨ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. 

##### FirstFragment í´ë˜ìŠ¤
- `onAttach` ë©”ì†Œë“œ
    - í”„ë˜ê·¸ë¨¼íŠ¸ê°€ ë§Œë“¤ì–´ì§ˆ ë•Œ ê°€ì¥ ë¨¼ì € ì‹¤í–‰í•˜ëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤.
    - ë’¤ë¡œê°€ê¸°(back press) ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì•¡í‹°ë¹„í‹°ê°€ í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì— ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œë˜ëŠ” í˜„ìƒì„ ë§‰ê¸° ìœ„í•œ ì½œë°± ë©”ì†Œë“œë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. 
    - ì›¹ í˜ì´ì§€ íˆìŠ¤í† ë¦¬ì—ì„œ ë’¤ë¡œ ê°ˆ í˜ì´ì§€ê°€ ìˆë‹¤ë©´ ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
    - ì›¹ ë·°ì—ì„œ ë’¤ë¡œ ê°ˆ í˜ì´ì§€ê°€ ì—†ë‹¤ë©´ ì•¡í‹°ë¹„í‹°ì˜ ë’¤ë¡œê°€ê¸° ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
- `onCreateView` ë©”ì†Œë“œ
    - ë ˆì´ì•„ì›ƒì— ë“±ë¡ëœ ë·° ê°ì²´ë“¤ì„ ë©¤ë²„ ë³€ìˆ˜ë“¤ê³¼ ì—°ê²°í•©ë‹ˆë‹¤. 
    - ì›¹ë·°ë¥¼ ì´ˆê¸°í•˜ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        - `initWebView` ë©”ì†Œë“œ í˜¸ì¶œ
    - `EditText`ì— ê°’ì„ ì´ìš©í•˜ì—¬ ì›¹ë·°ì˜ URLì„ ë³€ê²½í•˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
- `initWebView` ë©”ì†Œë“œ
    - ì›¹ ë·°ì—ì„œ ë‹¤ë¥¸ í™”ë©´ ë§í¬ í´ë¦­ ì‹œ ì›¹ ë·°ì˜ URLì„ ë³€ê²½í•˜ëŠ” ë©”ì†Œë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        - `WebViewClient` í´ë˜ìŠ¤ `shouldOverrideUrlLoading` ë©”ì†Œë“œ ì˜¤ë²„ë¼ì´ë“œ
    - ì›¹ ë·°ì—ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.
        - `webSettings.setJavaScriptEnabled(true)` ë©”ì†Œë“œ í˜¸ì¶œ
    - ì›¹ ë·°ì˜ ì´ˆê¸° URLì€ `https://junhyunny.github.io/`ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

```java
package com.example.myapplication;

import android.content.Context;
import android.graphics.Bitmap;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.view.inputmethod.EditorInfo;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.widget.EditText;
import android.widget.ProgressBar;

import androidx.activity.OnBackPressedCallback;
import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;

import com.example.myapplication.databinding.FragmentFirstBinding;

public class FirstFragment extends Fragment {

    private FragmentFirstBinding binding;

    private WebView webView;
    private ProgressBar progressBar;
    private EditText urlEditText;
    private OnBackPressedCallback onBackPressedCallback;

    public void initWebView() {

        webView.setWebViewClient(new WebViewClient() {

            @Override
            public void onPageStarted(WebView view, String url, Bitmap favicon) {
                super.onPageStarted(view, url, favicon);
                progressBar.setVisibility(View.VISIBLE);
            }

            @Override
            public void onPageFinished(WebView view, String url) {
                super.onPageFinished(view, url);
                progressBar.setVisibility(View.GONE);
            }

            @Override
            public boolean shouldOverrideUrlLoading(WebView view, String url) {
                view.loadUrl(url);
                return true;
            }
        });

        WebSettings webSettings = webView.getSettings();
        webSettings.setJavaScriptEnabled(true);
        webView.loadUrl("https://junhyunny.github.io/");
    }

    @Override
    public View onCreateView(
            LayoutInflater inflater,
            ViewGroup container,
            Bundle savedInstanceState
    ) {

        binding = FragmentFirstBinding.inflate(inflater, container, false);

        webView = binding.wView;
        progressBar = binding.pBar;
        urlEditText = binding.urlEt;

        progressBar.setVisibility(View.GONE);

        urlEditText.setOnEditorActionListener((textView, actionId, keyEvent) -> {
            if (actionId == EditorInfo.IME_ACTION_NEXT) {
                webView.loadUrl("https://" + urlEditText.getText().toString());
            }
            return false;
        });

        initWebView();

        return binding.getRoot();
    }

    public void onViewCreated(@NonNull View view, Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);
    }

    @Override
    public void onDestroyView() {
        super.onDestroyView();
        binding = null;
    }

    @Override
    public void onAttach(@NonNull Context context) {
        super.onAttach(context);
        onBackPressedCallback = new OnBackPressedCallback(true) {
            @Override
            public void handleOnBackPressed() {
                if (webView.canGoBack()) {
                    webView.goBack();
                } else {
                    requireActivity().onBackPressed();
                }
            }
        };
        requireActivity().getOnBackPressedDispatcher().addCallback(this, onBackPressedCallback);
    }
}
```

## 5. ì•ˆë“œë¡œì´ë“œ ì—ë®¬ë ˆì´í„° í…ŒìŠ¤íŠ¸

<p align="left">
    <img src="/images/temp/android-webview-1.gif" width="25%" class="image__border">
</p>

##### CLOSING

ì•ˆë“œë¡œì´ë“œ ê°œë°œìê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì˜ëª»ëœ ì„¤ëª…ì„ í•˜ê³  ìˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì‹œê¸¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. 

#### TEST CODE REPOSITORY
- <https://github.com/Junhyunny/blog-in-action/tree/master/2022-03-05-android-webview-communication>

#### REFERENCE
- <https://jhshjs.tistory.com/57>

[react-android-webview-communication-link]: https://junhyunny.github.io/react/android/react-android-webview-communication/

[cleartext-traffic-link]: https://developer.android.com/training/articles/security-config#CleartextTrafficPermitted


---  
title: "React ì„œë¹„ìŠ¤ í™”ë©´ê³¼ Android Webview í†µì‹ "  
search: false  
category:  
  - react  
  - android  
last_modified_at: 2022-03-05T23:55:00  
---  

<br/>

ğŸ‘‰ í•´ë‹¹ í¬ìŠ¤íŠ¸ë¥¼ ì½ëŠ”ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.
- [Android Webview ì‚¬ìš© ì˜ˆì œ][android-webview-link] 

## 0. ë“¤ì–´ê°€ë©´ì„œ

ì´ë²ˆì—” [Android Webview ì‚¬ìš© ì˜ˆì œ][android-webview-link]ì—ì„œ ë§Œë“  ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ í™”ë©´ë¼ë¦¬ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ê² ìŠµë‹ˆë‹¤.

## 1. ì•ˆë“œë¡œì´ë“œ ì›¹ ë·°

ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ í™”ë©´ê³¼ ì•ˆë“œë¡œì´ë“œ ì›¹ ë·°ì˜ í†µì‹ ì„ ì´í•´í•˜ê¸° ìœ„í•´ì„  ë‘˜ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. 
ì›¹ ë·°ëŠ” ì•ˆë“œë¡œì´ë“œì—ê² í•˜ë‚˜ì˜ ë·°(view)ì´ì§€ë§Œ, HTML ë¬¸ì„œ ì…ì¥ì—ì„œ ìì‹ ì„ ë Œë”ë§í•´ì£¼ëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤. 
ì›¹ ë·°ê°€ ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ HTML ë¬¸ì„œë¥¼ ì‘ë‹µìœ¼ë¡œ ë°›ìŠµë‹ˆë‹¤. 
- ì›¹ ë·°ëŠ” ì „ë‹¬ë°›ì€ HTML ë¬¸ì„œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
- ì›¹ ë·°ëŠ” ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ë¡œë¶€í„° ì „ë‹¬ë°›ì€ HTML ë¬¸ì„œì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ë¸Œë¼ìš°ì €ê°€ `window` ê°ì²´ë¥¼ í†µí•´ `Web API` ê¸°ëŠ¥ì„ ì œê³µí•˜ë“¯ì´ ì›¹ ë·°ë„ `window` ê°ì²´ë¥¼ í†µí•´ ë„¤ì´í‹°ë¸Œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. 
    - `JavaScript` ì½”ë“œë¥¼ ì´ìš©í•´ `window` ê°ì²´ì˜ ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
- ì›¹ ë·°ëŠ” `JavaScript` ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - `JavaScript` ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ìì‹ ì´ ë Œë”ë§ ì¤‘ì¸ HTML ë¬¸ì„œë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

##### ì•ˆë“œë¡œì´ë“œ ì›¹ ë·°ì˜ ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ ê³¼ì •

<p align="center">
    <img src="/images/temp/react-android-webview-communication-1.JPG" width="85%" class="image__border">
</p>

##### ì•ˆë“œë¡œì´ë“œ ì›¹ ë·°ì™€ HTML ë¬¸ì„œ í†µì‹ 
- ì›¹ ë·° ì¸ìŠ¤í„´ìŠ¤ì—ê²Œ ë Œë”ë§ ì¤‘ì¸ HTML ë¬¸ì„œì—ê²Œ ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- ì›¹ ë·° ì¸ìŠ¤í„´ìŠ¤ëŠ” ìì‹ ì˜ `evaluateJavascript` ë©”ì†Œë“œë¥¼ í†µí•´ `JavaScript` ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<p align="center">
    <img src="/images/temp/react-android-webview-communication-2.JPG" width="55%" class="image__border">
</p>

## 2. ì•ˆë“œë¡œì´ë“œ ì›¹ ë·° ìë°”ìŠ¤í¬ë¦½íŠ¸ ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€

### 2.1. JavaScript ì¸í„°í˜ì´ìŠ¤ ë§Œë“¤ê¸°

##### JavascriptCallbackClient í´ë˜ìŠ¤
- ë Œë”ë§ ì¤‘ì¸ HTML ë¬¸ì„œì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë©”ì†Œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
- í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë©”ì†Œë“œì— `@JavascriptInterface` ì• ë„ˆí…Œì´ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
- `showToastMessage` ë©”ì†Œë“œ
    - HTML ë¬¸ì„œì—ì„œ ì „ë‹¬í•œ ë©”ì„¸ì§€ë¥¼ í† ìŠ¤íŠ¸ ê¸°ëŠ¥ì„ í†µí•´ í™”ë©´ì— ë„ì›ë‹ˆë‹¤.
- `callJavaScriptFunction` ë©”ì†Œë“œ
    - 5ì´ˆ ë’¤ `JavaScript` ì½”ë“œë¥¼ ì´ìš©í•´ ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸(CustomEvent)ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤.
    - ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ì˜ ì´ë¦„ì€ `"javascriptFunction"` ì…ë‹ˆë‹¤.
    - ë°œí–‰í•œ ì´ë²¤íŠ¸ë¥¼ ì´ìš©í•´ ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ì˜ ìƒíƒœë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.

```java
package com.example.myapplication.web;

import android.app.Activity;
import android.webkit.JavascriptInterface;
import android.webkit.WebView;
import android.widget.Toast;

public class JavascriptCallbackClient {

    private Activity mContext;
    private WebView webView;

    public JavascriptCallbackClient(Activity activity, WebView webView) {
        this.mContext = activity;
        this.webView = webView;
    }

    private String publishEvent(String functionName, String data) {
        StringBuffer buffer = new StringBuffer()
                .append("window.dispatchEvent(\n")
                .append("   new CustomEvent(\"").append(functionName).append("\", {\n")
                .append("           detail: {\n")
                .append("               data: ").append(data).append("\n")
                .append("           }\n")
                .append("       }\n")
                .append("   )\n")
                .append(");");
        return buffer.toString();
    }

    @JavascriptInterface
    public void showToastMessage(final String message) {
        Toast.makeText(mContext, message, Toast.LENGTH_SHORT).show();
    }

    @JavascriptInterface
    public void callJavaScriptFunction() {
        webView.postDelayed(() -> {
            webView.evaluateJavascript(publishEvent("javascriptFunction", "\"Hello, I'm message from Android\""),
                    (result) -> {
                        Toast.makeText(mContext, result, Toast.LENGTH_SHORT).show();
                    }
            );
        }, 5000);
    }
}
```

### 2.2. JavaScript ì¸í„°í˜ì´ìŠ¤ ë“±ë¡í•˜ê¸°

ì „ì²´ ì½”ë“œë¥¼ í™•ì¸í•˜ì‹œë ¤ë©´ [Android Webview ì‚¬ìš© ì˜ˆì œ][android-webview-link] í¬ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

##### FirstFragment í´ë˜ìŠ¤
- `WebView` í´ë˜ìŠ¤ì˜ `addJavascriptInterface` ë©”ì†Œë“œë¡œ ì´ì „ ë‹¨ê³„ì—ì„œ ë§Œë“  `JavascriptCallbackClient` í´ë˜ìŠ¤ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
- `HTML` ë¬¸ì„œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì´ë¦„ì„ `android`ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
    - `window` ê°ì²´ë¡œë¶€í„° `android` ê°ì²´ë¥¼ êº¼ë‚´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ì£¼ì†Œë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.
    - ì•ˆë“œë¡œì´ë“œ ì•±ì€ ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤ ì£¼ì†Œë¥¼ ëª¨ë¥´ê¸° ë•Œë¬¸ì— `LAN IP`ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.

```java
package com.example.myapplication;

public class FirstFragment extends Fragment {

    private FragmentFirstBinding binding;

    private WebView webView;
    private ProgressBar progressBar;
    private EditText urlEditText;
    private OnBackPressedCallback onBackPressedCallback;

    public void initWebView() {

        webView.setWebViewClient(new WebViewClient() {

            @Override
            public void onPageStarted(WebView view, String url, Bitmap favicon) {
                super.onPageStarted(view, url, favicon);
                progressBar.setVisibility(View.VISIBLE);
            }

            @Override
            public void onPageFinished(WebView view, String url) {
                super.onPageFinished(view, url);
                progressBar.setVisibility(View.GONE);
            }

            @Override
            public boolean shouldOverrideUrlLoading(WebView view, String url) {
                view.loadUrl(url);
                return true;
            }
        });

        WebSettings webSettings = webView.getSettings();
        webSettings.setJavaScriptEnabled(true);

        // JavaScript ì¸í„°í˜ì´ìŠ¤ ë“±ë¡
        webView.addJavascriptInterface(new JavascriptCallbackClient(requireActivity(), webView), "android");
        webView.loadUrl("http://192.168.0.216:3000/");
    }

    // ...
}
```

## 3. ë¦¬ì•¡íŠ¸ ì„œë¹„ìŠ¤

### 3.1. App.jsx íŒŒì¼

- `window` ê°ì²´ì— `android` ê°ì²´ê°€ ìˆëŠ” ê²½ìš° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
    - `showToastMessage` í•¨ìˆ˜ - `"Hello Native Callback"` ë©”ì„¸ì§€ë¥¼ ì „ë‹¬í•˜ì—¬ í† ìŠ¤íŠ¸ ë©”ì„¸ì§€ë¥¼ ë„ì›ë‹ˆë‹¤.
    - `callJavaScriptFunction` í•¨ìˆ˜ - ë„¤ì´í‹°ë¸Œ ì•±ì—ì„œ 5ì´ˆ ë’¤ì— `"javascriptFunction"` ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤. 
- ì›¹ ë·°ì—ì„œ ë°œí–‰ì‹œí‚¬ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. 
    - ì´ë²¤íŠ¸ ì´ë¦„ì€ `"javascriptFunction"`ì…ë‹ˆë‹¤.
    - ë„¤ì´í‹°ë¸Œ ì•±ìœ¼ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ë‚´ìš©ìœ¼ë¡œ í™”ë©´ì— ë³´ì´ëŠ” ë©”ì„¸ì§€ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.

```jsx
import logo from './logo.svg'
import './App.css'
import {useEffect, useState} from "react";

function App() {

    const [messageFromAndroid, setMessageFromAndroid] = useState('Hello Vite + React!');

    useEffect(() => {

        const eventFromAndroid = async (event) => {
            setMessageFromAndroid(event.detail.data);
        }

        window.addEventListener('javascriptFunction', eventFromAndroid);

        if (window.android) {
            window.android.showToastMessage("Hello Native Callback");
            window.android.callJavaScriptFunction();
        }

        return () => {
            window.removeEventListener('javascriptFunction', eventFromAndroid);
        };
    }, []);

    return (<div className="App">
        <header className="App-header">
            <img src={logo} className="App-logo" alt="logo"/>
            <p>{messageFromAndroid}</p>
            <p>
                Edit <code>App.jsx</code> and save to test HMR updates.
            </p>
            <p>
                <a
                    className="App-link"
                    href="https://reactjs.org"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    Learn React
                </a>
                {' | '}
                <a
                    className="App-link"
                    href="https://vitejs.dev/guide/features.html"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    Vite Docs
                </a>
            </p>
        </header>
    </div>)
}

export default App
```

## 4. ì•ˆë“œë¡œì´ë“œ ì—ë®¬ë ˆì´í„° í…ŒìŠ¤íŠ¸

<p align="left">
    <img src="/images/temp/react-android-webview-communication-3.gif" width="25%" class="image__border">
</p>

##### CLOSING

ì•ˆë“œë¡œì´ë“œ ê°œë°œìê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì˜ëª»ëœ ì„¤ëª…ì„ í•˜ê³  ìˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì‹œê¸¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. 

#### TEST CODE REPOSITORY
- <https://github.com/Junhyunny/blog-in-action/tree/master/2022-03-05-android-webview-communication>

#### REFERENCE
- <https://developer.mozilla.org/ko/docs/Web/API/CustomEvent/CustomEvent>
- <https://programmer-eun.tistory.com/54>

[android-webview-link]: https://junhyunny.github.io/android/android-webview/

[mozilla-custom-event-link]: https://developer.mozilla.org/ko/docs/Web/API/CustomEvent/CustomEvent